<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Luxura • Swagger & SEO Pro</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0a0a0a; --panel:#111; --line:#1e1e1e; --fg:#f7f7f5; --muted:#b9b9b4;
      --gold:#d4af37; --gold-2:#b8932e; --danger:#ff6b6b; --ok:#8BE28B;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--fg);font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
    .wrap{max-width:1200px;margin:0 auto;padding:24px}
    .topbar{display:flex;align-items:center;justify-content:space-between;gap:16px;flex-wrap:wrap;margin-bottom:16px}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,var(--gold),var(--gold-2));
      display:flex;align-items:center;justify-content:center;overflow:hidden;box-shadow:0 0 0 1px #2a2a2a}
    .logo img{width:100%;height:100%;object-fit:contain}
    .title{font-weight:800;font-size:18px}
    .muted{color:var(--muted);font-size:12px}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:16px}
    label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
    input,textarea{width:100%;padding:10px;border:1px solid var(--line);border-radius:12px;background:#0d0d0d;color:var(--fg)}
    textarea{min-height:90px;resize:vertical}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    button{padding:10px 14px;border:1px solid var(--gold-2);border-radius:12px;background:var(--gold);color:#111;cursor:pointer;font-weight:800}
    button.ghost{background:transparent;color:var(--fg);border-color:var(--line);font-weight:700}
    a.btn-link{
      display:inline-flex;align-items:center;justify-content:center;
      padding:10px 14px;border:1px solid var(--line);border-radius:12px;
      color:var(--fg);text-decoration:none;font-weight:800;background:transparent
    }
    a.btn-link:hover{border-color:var(--gold-2)}
    .ok{color:var(--ok)} .err{color:var(--danger)}
    pre{white-space:pre-wrap;word-break:break-word;background:#0d0d0d;border:1px solid var(--line);
      border-radius:12px;padding:12px;color:#eaeae5;max-height:420px;overflow:auto;font-size:12px}
    iframe{width:100%;height:700px;border:1px solid var(--line);border-radius:16px;background:#0d0d0d}
    .toast{position:fixed;left:50%;bottom:24px;transform:translateX(-50%) translateY(20px);
      background:#141414;border:1px solid #2a2a2a;color:var(--fg);
      padding:10px 14px;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.35);
      opacity:0;pointer-events:none;transition:all .25s ease;z-index:9999;font-size:14px}
    .toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
    .toast.ok{border-color:#214a21;color:#d8f7d8}
    .toast.err{border-color:#5a2a2a;color:#ffd7d7}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo">
          <img src="https://static.wixstatic.com/media/de6cdb_1818e78bd1294722811849c73ea77774~mv2.png" alt="Luxura Logo">
        </div>
        <div>
          <div class="title">Luxura — Swagger & SEO Pro</div>
          <div class="muted">Dashboard admin (docs + SEO) • style Luxura noir & or</div>
        </div>
      </div>
      <div class="muted" id="jsStatus">JS: …</div>
    </div>

    <div class="card" style="margin-bottom:16px;">
      <label>URL de l’API (Render)</label>
      <input id="apiUrl" value="https://luxura-inventory-api.onrender.com" />

      <div class="muted" style="margin-top:6px;">
        Astuce: si rien ne marche, c’est que le JS a crash → on l’affiche ici.
      </div>

      <div class="row" style="margin-top:12px;">
        <button id="btnHealth">Tester Health</button>
        <a class="btn-link" id="lnkDocs" target="_blank" rel="noopener noreferrer">Swagger /docs</a>
        <a class="btn-link" id="lnkLastSync" target="_blank" rel="noopener noreferrer">Dernier Sync</a>
        <a class="btn-link" id="lnkXls" target="_blank" rel="noopener noreferrer">Export XLS (Entrepôt)</a>
        <span id="statusLine" class="muted"></span>
      </div>
    </div>

    <div class="card" style="margin-bottom:16px;">
      <div class="row" style="justify-content:space-between;">
        <div style="font-weight:800;">Swagger intégré</div>
        <button class="ghost" id="btnReloadSwagger">Recharger</button>
      </div>
      <div class="muted" style="margin:8px 0 10px;">
        Si l’iframe reste noir, c’est souvent bloqué côté serveur (CSP/X-Frame-Options). Les liens au-dessus restent utilisables.
      </div>
      <iframe id="swaggerFrame" src=""></iframe>
    </div>

    <div class="card">
      <div style="font-weight:800;margin-bottom:10px;">SEO Preview (safe)</div>
      <div class="row" style="margin-bottom:10px;">
        <input id="seoCategory" placeholder="Catégorie (optionnel) ex: Genius" style="max-width:320px;">
        <input id="seoLimit" value="50" style="max-width:120px;">
        <button id="btnSeoPreview">SEO Preview</button>
      </div>
      <pre id="seoOut">Aucun résultat…</pre>
    </div>
  </div>

  <div id="toast" class="toast"></div>

<script>
(function(){
  const $ = (id)=>document.getElementById(id);

  function toast(msg, ok=true){
    const el=$("toast");
    el.textContent=msg;
    el.className="toast "+(ok?"ok":"err");
    void el.offsetWidth;
    el.classList.add("show");
    setTimeout(()=>el.classList.remove("show"), 2200);
  }

  function baseUrl(){
    return ($("apiUrl").value || "").trim().replace(/\/+$/,"");
  }
  function setLinks(){
    const b=baseUrl();
    $("lnkDocs").href = b + "/docs";
    $("lnkLastSync").href = b + "/wix/sync/last";
    $("lnkXls").href = b + "/inventory/export.xlsx?salon_id=4";
    $("swaggerFrame").src = b + "/docs";
  }

  // expose JS status
  $("jsStatus").textContent = "JS: OK";
  setLinks();

  // change apiUrl updates links
  $("apiUrl").addEventListener("input", setLinks);

  $("btnReloadSwagger").addEventListener("click", ()=>{
    setLinks();
    toast("Swagger rechargé", true);
  });

  $("btnHealth").addEventListener("click", async ()=>{
    $("statusLine").textContent = "⏳ Health...";
    try{
      const r = await fetch(baseUrl()+"/health", { headers: { "Accept":"application/json" } });
      const txt = await r.text();
      if(r.ok){
        $("statusLine").textContent = "✅ Health OK";
        toast("Health OK", true);
      }else{
        $("statusLine").textContent = "❌ Health "+r.status;
        toast("Health erreur "+r.status, false);
      }
    }catch(e){
      $("statusLine").textContent = "❌ API injoignable";
      toast("API injoignable", false);
    }
  });

  $("btnSeoPreview").addEventListener("click", async ()=>{
    const b = baseUrl();
    const cat = ($("seoCategory").value||"").trim();
    const limit = parseInt(($("seoLimit").value||"50"),10) || 50;

    const qs = new URLSearchParams();
    qs.set("limit", String(limit));
    qs.set("only_missing", "false");
    if(cat) qs.set("category", cat);

    $("seoOut").textContent = "⏳ Preview...";
    try{
      const r = await fetch(b + "/seo/preview?" + qs.toString(), { method:"POST", headers: { "Accept":"application/json" } });
      const txt = await r.text();
      if(!r.ok){
        $("seoOut").textContent = "❌ "+r.status+"\n"+txt;
        toast("SEO Preview erreur", false);
        return;
      }
      $("seoOut").textContent = txt;
      toast("SEO Preview OK", true);
    }catch(e){
      $("seoOut").textContent = "❌ API injoignable";
      toast("SEO Preview impossible", false);
    }
  });

  // crash catcher visible
  window.addEventListener("error", (ev)=>{
    $("jsStatus").textContent = "JS: ERROR";
    $("jsStatus").className = "err";
    $("statusLine").textContent = "❌ JS error: "+(ev.message||"");
  });
})();
</script>
</body>
</html>
